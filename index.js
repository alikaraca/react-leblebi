"use strict";
var React = require('../react');var _extends=Object.assign||function(a){for(var c,b=1;b<arguments.length;b++)for(var d in c=arguments[b],c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d]);return a},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_react=require("react");Object.defineProperty(exports,"__esModule",{value:!0});function _asyncToGenerator(a){return function(){var b=a.apply(this,arguments);return new Promise(function(c,d){function e(f,g){try{var h=b[f](g),j=h.value}catch(k){return void d(k)}return h.done?void c(j):Promise.resolve(j).then(function(k){e("next",k)},function(k){e("throw",k)})}return e("next")})}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"==typeof b||"function"==typeof b)?b:a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var Leblebi=function(a){function b(){var d=this;_classCallCheck(this,b);var c=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return c.handleClick=function(e){var f=c.state.result,g=f[e].raw;c.setState({result:[],value:g})},c.handleHover=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1;c.setState({activeItemIndex:e})},c.handleChange=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function f(g){var j,k,l,m,n,h=g.target;return regeneratorRuntime.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return j=h.value,k=c.props.config,l=void 0===k?{}:k,m=l.delay,n=void 0===m?300:m,c.setState({activeItemIndex:-1,value:j}),c.timeOut&&clearTimeout(c.timeOut),c.timeOut=setTimeout(function(){c.fetchData()},n),p.abrupt("return",null);case 7:case"end":return p.stop();}},f,d)}));return function(){return e.apply(this,arguments)}}(),c.handleKeyDown=function(e){var f=c.state.result,g=c.keyCode.tab,h=e.keyCode;return h===g&&f.length&&e.preventDefault(),!1},c.handleKeyUp=function(e){var f=e.keyCode,_this$keyCode=c.keyCode,g=_this$keyCode.up,h=_this$keyCode.down,j=_this$keyCode.enter,k=_this$keyCode.tab,_this$state=c.state,l=_this$state.activeItemIndex,m=_this$state.result,n=m.length-1;if(f===g)return 0<l?c.setState(function(p){return{activeItemIndex:p.activeItemIndex-1}}):c.setState({activeItemIndex:n}),null;if(f===h)return l<n?c.setState(function(p){return{activeItemIndex:p.activeItemIndex+1}}):c.setState({activeItemIndex:0}),null;if((f===j||f===k)&&-1<l){e.preventDefault();var o=m[l].raw;c.setState({activeItemIndex:-1,result:[],value:o})}return null},c.fetchData=_asyncToGenerator(regeneratorRuntime.mark(function e(){var f,g,h,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;return regeneratorRuntime.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(f=c.state,g=f.style,h=f.value,j=c.props,k=j.config,l=void 0===k?{}:k,m=j.classNames,n=void 0===m?{}:m,o=l.field,p=void 0!==o&&o,q=l.prop,r=void 0!==q&&q,s=l.limit,t=void 0===s?10:s,u=c.props.data,v=[],w=l.lang||void 0,"function"!=typeof u){A.next=10;break}return A.next=9,u(h);case 9:u=A.sent;case 10:r&&(u=c.objDeepGetProp(u,r)),Array.isArray(u)||(u=[]),x=void 0,u.forEach(function(B,C){x=p?B[p].toLocaleLowerCase(w):B.toLocaleLowerCase(w);var D=x.indexOf(h.toLocaleLowerCase(w)),E=D+h.length;if(-1<D){var G=x.slice(D,E),H=c.objectToInlineStyle(g.leblebiWord),I="leblebi-word "+(n.leblebiWord||""),J=x.replace(G,"<span class=\""+I+"\" style=\""+H+"\">"+G+"</span>");v.push({id:B[p].id||C,raw:x,custom:J})}return!1}),y=h.length?v.slice(0,t):[],c.setState({result:y});case 16:case"end":return A.stop();}},e,d)})),c.objectToInlineStyle=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},f="";return Object.keys(e).forEach(function(g){var h=g.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/\s+/g,"-").toLowerCase(),j="number"==typeof e[g]?e[g]+"px":e[g];f+=h+":"+j+";"}),f},c.objDeepGetProp=function(e,f){if(!e||"object"!==("undefined"==typeof e?"undefined":_typeof(e)))return!1;var g=f.split("."),h=e;return g.forEach(function(j){h=!!h[j]&&h[j]}),h},c.state={value:"",style:{},result:[],activeItemIndex:0},c.keyCode={up:38,down:40,enter:13,tab:9},c}return _inherits(b,a),_createClass(b,[{key:"componentWillMount",value:function componentWillMount(){var e={leblebi:{display:"flex",flexDirection:"column"},leblebiInput:{},leblebiResult:{background:"#fff",border:"1px solid #ccc",padding:1},leblebiItem:{cursor:"pointer",padding:6},leblebiItemActive:{background:"#2666b9",color:"#fff"},leblebiWord:{padding:"3px 1px 0px",border:"1px solid #ffd94f",color:"#f9a500",background:"#ffefd3",borderRadius:2,fontWeight:"normal",margin:"0px 1px",boxShadow:"1px 1px 1px -1px #000000"}},_props=this.props,_props$style=_props.style,c=void 0===_props$style?{}:_props$style,_props$config=_props.config,d=void 0===_props$config?{}:_props$config,f=d.noDefaultStyle?{}:_extends({},e);Object.keys(c).forEach(function(g){f[g]=_extends({},e[g],c[g])}),this.state.style=f}},{key:"render",value:function render(){var h=this,_state=this.state,c=_state.style,d=_state.value,e=_state.result,f=_state.activeItemIndex,_props$classNames=this.props.classNames,g=void 0===_props$classNames?{}:_props$classNames;return React.createElement(_react.Fragment,null,React.createElement("div",{className:"leblebi "+(g.leblebi||""),style:c.leblebi},React.createElement("input",{className:"leblebi-input "+(g.leblebiInput||""),onChange:this.handleChange,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,value:d,type:"text",style:c.leblebiInput}),0<e.length&&React.createElement("div",{className:"leblebi-result "+(g.leblebiResult||""),style:c.leblebiResult},e.map(function(j,k){var l={},m="leblebi-item "+(g.leblebiItem||"");return f===k&&(l=c.leblebiItemActive,m+=" leblebi-item-active "+(g.leblebiItemActive||"")),React.createElement("div",{key:j.id,index:k,className:m,onClick:function onClick(){return h.handleClick(k)},onFocus:function onFocus(){return h.handleHover(k)},onBlur:function onBlur(){return h.handleHover()},onMouseOver:function onMouseOver(){return h.handleHover(k)},onMouseOut:function onMouseOut(){return h.handleHover()},style:_extends({},l,c.leblebiItem),dangerouslySetInnerHTML:{__html:j.custom}})}))))}}]),b}(_react.Component);exports.default=Leblebi;